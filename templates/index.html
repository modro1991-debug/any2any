<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Any2Any — Free Online File Converter</title>
<meta name="description" content="Convert images, videos, audio, documents, subtitles, contacts and data online. Fast, private, and free. Files are processed temporarily and auto-delete.">
<style>
  :root{
    --bg:#0b1020;--panel:#0f1630;--card:#121a3a;--muted:#9ab0d6;
    --line:#1f2a4a;--cta:#2a66ff;--cta-2:#5ea1ff;--ok:#1f8a4d;--err:#a23a3a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#e7ecf5;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
  .wrap{max-width:960px;margin:auto;padding:24px}
  .hero{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:28px}
  h1{margin:0 0 6px 0;font-size:28px;letter-spacing:.2px}
  .muted{color:#9ab0d6;font-size:14px}

  .grid{display:grid;gap:16px;grid-template-columns:1fr; margin-top:18px}
  @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}

  .drop{border:2px dashed var(--line);background:var(--card);border-radius:16px;padding:22px;display:flex;align-items:center;justify-content:center;min-height:180px;text-align:center;transition:.2s}
  .drop.drag{border-color:var(--cta);box-shadow:0 0 0 3px rgba(42,102,255,.25) inset}
  .drop input{display:none}
  .drop .cta{display:inline-flex;align-items:center;gap:8px;background:var(--cta);border:none;padding:10px 14px;border-radius:12px;color:white;font-weight:600;cursor:pointer}
  .filemeta{margin-top:10px;font-size:14px;color:var(--muted)}

  .section-title{margin:0 0 8px 0;font-size:14px;color:var(--muted);letter-spacing:.3px;text-transform:uppercase}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--line);background:#0b1020;padding:8px 12px;border-radius:999px;cursor:pointer;font-size:14px}
  .chip.active,.chip:hover{border-color:var(--cta);box-shadow:0 0 0 2px rgba(42,102,255,.25)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px}
  select,button{background:#0b1020;color:#e7ecf5;border:1px solid var(--line);border-radius:12px;padding:10px 12px}
  button.convert{background:var(--cta);border:none;font-weight:600}
  button.convert:disabled{opacity:.6;cursor:not-allowed}

  details{margin-top:8px}
  details summary{cursor:pointer;color:var(--muted)}

  .progress{height:8px;background:#1a2448;border-radius:6px;overflow:hidden;margin-top:12px}
  .bar{height:8px;background:var(--cta);width:0%}
  .result{margin-top:12px;font-size:14px}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line);background:#0b1020}
  .pill.ok{background:#0f2f1a;border-color:#1d623a}
  .pill.err{background:#2f1010;border-color:#6a2a2a}
  a.link{color:#7fb2ff;text-decoration:none}

  .footer{margin-top:18px;font-size:12px;color:#9ab0d6;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .footer a{color:#7fb2ff;text-decoration:none}

  /* --- Cookie banner (polite) --- */
  .cookie-banner{
    position: fixed; left: 12px; right: 12px; bottom: 12px; z-index: 50;
    background: #121a3a; border:1px solid #1f2a4a; color:#e7ecf5;
    border-radius: 14px; padding: 12px 14px; display: none;
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
  }
  .cookie-banner.show{ display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
  .cookie-banner p{ margin:0; font-size: 14px; color:#9ab0d6 }
  .cookie-actions{ margin-left: auto; display:flex; gap:8px; }
  .cookie-btn{ border:1px solid #1f2a4a; background:#0b1020; color:#e7ecf5; padding:8px 12px; border-radius:10px; cursor:pointer }
  .cookie-btn.primary{ background:#2a66ff; border:none; font-weight:600 }
  .cookie-btn:focus{ outline: 2px solid #5ea1ff; outline-offset:2px }
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>Any2Any File Converter</h1>
      <div class="muted">Fast, private, and free. We never store your files — they are processed temporarily and auto-deleted after conversion.</div>

      <div class="grid">
        <!-- Left: drop zone + progress/result -->
        <div class="panel">
          <div id="drop" class="drop" tabindex="0" aria-label="Drop file here">
            <div>
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="opacity:.9;margin-bottom:8px">
                <path d="M12 16V4m0 0l-4 4m4-4l4 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2" stroke="white" stroke-opacity=".7" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <div style="font-weight:600;margin-bottom:6px;">Drag & drop a file</div>
              <div class="muted">or</div>
              <br/>
              <label>
                <input id="file" type="file" />
                <button class="cta" type="button" id="browseBtn">Choose file</button>
              </label>
              <div id="filemeta" class="filemeta" aria-live="polite"></div>
            </div>
          </div>

          <div class="progress"><div id="bar" class="bar"></div></div>
          <div id="result" class="result"></div>
        </div>

        <!-- Right: target selection -->
        <div class="panel">
          <div class="section-title">Target format</div>
          <div id="chips" class="chips" aria-label="Suggested formats"></div>

          <details id="moreBox">
            <summary style="margin-top:10px">More formats</summary>
            <div class="row" style="margin-top:8px">
              <select id="targetSelect" aria-label="All formats"></select>
              <button id="convertBtn" class="convert" disabled>Convert</button>
            </div>
          </details>

          <div class="muted" style="margin-top:10px">
            Tips: HEIC→JPG • DOCX→PDF • MP4→MP3 • PDF→DOCX •
            <strong>Phone list → Clean CSV</strong> • <strong>VCF⇄CSV</strong> • <strong>SRT⇄VTT</strong>
          </div>
        </div>
      </div>

      <div class="footer">
        <span>© 2025 Any2Any</span> ·
        <a href="/privacy">Privacy</a> ·
        <a href="/cookies">Cookies</a> ·
        <span>Files auto-delete after ~20 minutes. We do not save files or personal data.</span>
      </div>
    </div>
  </div>

  <!-- Cookie banner -->
  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent">
    <p>We use a small cookie to remember your choice. No tracking, no ads. <a href="/cookies" class="link">Learn more</a>.</p>
    <div class="cookie-actions">
      <button id="cookieAccept" class="cookie-btn primary">Accept</button>
      <button id="cookieDecline" class="cookie-btn" aria-label="Decline and continue">Decline</button>
    </div>
  </div>

  <!-- App logic -->
  <script>
    // --- Helpers ---------------------------------------------------------------
    const $ = (q) => document.querySelector(q);
    const bar = $("#bar");
    const drop = $("#drop");
    const fileInput = $("#file");
    const browseBtn = $("#browseBtn");
    const filemeta = $("#filemeta");
    const chipsWrap = $("#chips");
    const targetSelect = $("#targetSelect");
    const convertBtn = $("#convertBtn");
    const resultBox = $("#result");

    // Supported formats (must match backend)
    const IMAGE_IN = ["jpg","jpeg","png","webp","gif","tiff","bmp","ico","pdf"];
    const AV_IN    = ["mp3","wav","aac","flac","ogg","mp4","mkv","mov","webm"];
    const DOC_IN   = ["pdf","doc","docx","ppt","pptx","xls","xlsx","odt","odp","ods","rtf","txt"];
    const DATA_IN  = ["csv","xlsx","txt","vcf","srt","vtt","json","yaml","yml"];

    const IMAGE_OUT = IMAGE_IN;
    const AV_OUT    = AV_IN;
    const DOC_OUT   = ["pdf","docx","pptx","xlsx","odt","odp","ods"];
    const DATA_OUT  = [
      "phonecsv",  // phone list cleaner
      "csv","vcf", // contacts
      "srt","vtt", // subtitles
      "csv_from_json","json_from_csv","json_from_yaml","yaml_from_json"
    ];

    function extOf(name){ const m=/\.[^.]+$/.exec(name||""); return m?m[0].slice(1).toLowerCase():""; }
    function humanSize(n){ if(!n&&n!==0) return ""; const u=["B","KB","MB","GB"]; let i=0; while(n>=1024&&i<u.length-1){n/=1024;i++} return `${n.toFixed(n<10&&i?1:0)} ${u[i]}`; }

    const SUGGEST = {
      image: ["jpg","png","webp","pdf"],
      video: ["mp4","webm","mov","mp3"],
      audio: ["mp3","wav","aac","flac"],
      doc:   ["pdf","docx","pptx","xlsx"],
      data:  ["phonecsv","csv","vcf","vtt","srt","csv_from_json","json_from_csv"]
    };

    function guessCategory(ext){
      if(IMAGE_IN.includes(ext)) return "image";
      if(AV_IN.includes(ext)){ return ["mp4","mkv","mov","webm"].includes(ext) ? "video" : "audio"; }
      if(DOC_IN.includes(ext)) return "doc";
      if(DATA_IN.includes(ext)) return "data";
      return "doc";
    }
    function allTargetsFor(cat){
      if(cat==="image") return IMAGE_OUT;
      if(cat==="video"||cat==="audio") return AV_OUT;
      if(cat==="data") return DATA_OUT;
      return DOC_OUT;
    }

    function setSuggestions(cat){
      chipsWrap.innerHTML = "";
      const opts = allTargetsFor(cat);
      targetSelect.innerHTML = opts.map(o=>`<option value="${o}">${o.toUpperCase()}</option>`).join("");
      const top = (SUGGEST[cat]||[]).filter(x=>opts.includes(x));
      top.forEach(fmt=>{
        const chip=document.createElement("button");
        chip.type="button"; chip.className="chip"; chip.textContent=fmt.toUpperCase();
        chip.addEventListener("click", ()=>{
          [...chipsWrap.querySelectorAll(".chip")].forEach(c=>c.classList.remove("active"));
          chip.classList.add("active"); targetSelect.value=fmt; convertBtn.disabled=!fileInput.files.length;
        });
        chipsWrap.appendChild(chip);
      });
      const first = chipsWrap.querySelector(".chip"); if(first) first.click();
    }

    // Drag & drop
    ["dragenter","dragover"].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.add("drag");}));
    ["dragleave","drop"].forEach(ev=>drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.remove("drag");}));
    drop.addEventListener("drop", e=>{ const f=e.dataTransfer.files?.[0]; if(f){ fileInput.files=e.dataTransfer.files; onFilePicked(f);} });
    browseBtn.addEventListener("click", ()=> fileInput.click());
    fileInput.addEventListener("change", ()=>{ const f=fileInput.files?.[0]; if(f) onFilePicked(f); });

    function onFilePicked(file){
      resultBox.innerHTML=""; bar.style.width="0%";
      const ext=extOf(file.name), cat=guessCategory(ext);
      setSuggestions(cat); filemeta.textContent=`${file.name} — ${ext.toUpperCase()} • ${humanSize(file.size)}`;
      convertBtn.disabled=false;
    }

    // Convert
    convertBtn.addEventListener("click", ()=>{
      const file=fileInput.files?.[0]; if(!file){ note("Please choose a file first.", true); return; }
      const target=targetSelect.value; if(!target){ note("Please choose a target format.", true); return; }
      resultBox.innerHTML=""; bar.style.width="0%";

      const fd=new FormData(); fd.append("file", file); fd.append("target", target);
      const xhr=new XMLHttpRequest(); xhr.open("POST","/api/convert");
      xhr.upload.onprogress=(ev)=>{ if(ev.lengthComputable) bar.style.width=Math.round((ev.loaded/ev.total)*100)+"%"; };
      xhr.onreadystatechange=()=>{ if(xhr.readyState===XMLHttpRequest.DONE){
        try{ const data=JSON.parse(xhr.responseText);
          if(xhr.status===200){
            const t = data.process_time ? ` <span class="muted">(⏱ ${data.process_time}s)</span>` : "";
            resultBox.innerHTML=`<span class="pill ok">Done</span> <a class="link" href="${data.download}" download>Download ${escapeHtml(data.filename)}</a>${t}`;
          }else{
            resultBox.innerHTML=`<span class="pill err">Error</span> ${escapeHtml(data.detail||xhr.responseText)}`;
          }
        }catch{ resultBox.textContent=xhr.responseText||"Unknown error"; }
      }};
      xhr.send(fd);
    });

    function note(t, err=false){ resultBox.innerHTML=`<span class="pill ${err?'err':'ok'}">${err?'Error':'Note'}</span> ${escapeHtml(t)}`; }
    function escapeHtml(s){return String(s).replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));}

    // --- Cookie consent (polite) ---------------------------------------------
    const cb = document.getElementById('cookieBanner');
    const btnA = document.getElementById('cookieAccept');
    const btnD = document.getElementById('cookieDecline');

    function setCookie(name, value, days){
      const maxAge = days*24*60*60;
      document.cookie = `${name}=${encodeURIComponent(value)}; Max-Age=${maxAge}; Path=/; SameSite=Lax`;
    }
    function getCookie(name){
      return document.cookie.split(';').map(s=>s.trim()).find(s=>s.startsWith(name+'='))?.split('=')[1];
    }
    function showBannerIfNeeded(){
      const c = getCookie('consent');
      if(!c){ cb.classList.add('show'); cb.setAttribute('aria-hidden','false'); }
    }
    function onAccept(){
      setCookie('consent','accept', 180);
      cb.classList.remove('show'); cb.setAttribute('aria-hidden','true');
      // loadAnalytics(); // add optional analytics here AFTER consent
    }
    function onDecline(){
      cb.classList.remove('show'); cb.setAttribute('aria-hidden','true');
    }
    btnA.addEventListener('click', onAccept);
    btnD.addEventListener('click', onDecline);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && cb.classList.contains('show')) onDecline(); });
    showBannerIfNeeded();
    function loadAnalytics(){ /* add optional analytics here if ever needed */ }
  </script>
</body>
</html>
